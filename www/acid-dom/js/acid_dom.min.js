/**
 * AcID Dom Inspector 1.0.1
 *
 * @file        acid_dom.min.js
 * @author      Jan Myler <info@janmyler.com>
 * @copyright   Copyright 2013, Jan Myler (http://janmyler.com)
 * @license     MIT License (http://www.opensource.org/licenses/mit-license.php)
 *
 * Licensed under The MIT License
 * Redistributions of files must retain the above copyright notice.
 */
(function(e,t,n){"use strict";function i(){if(typeof e.console==="undefined"){var t={};t.log=t.error=t.warn=t.dir=function(){}}}function s(){if(!e.Node){return{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}}function o(t,n,r,i){if(typeof t!=="object"){throw"addEvent: Expected argument elem of type object, "+typeof t+" given."}if(e.addEventListener){if(!i){i=false}t.addEventListener(n,r,i)}else{t.attachEvent("on"+n,r)}}function u(n,i,s,u,a,f,l){var c=function(n){var r=n?n.target:e.event.srcElement,i=a.substr(1),o=false;if(l){var u=r;while(u!==t){if(u.id===l){return}u=u.parentNode}}if(a.indexOf("#")===0){o=r.id===i}else if(a.indexOf(".")===0){o=r.className.indexOf(i)!==-1}else if(a==="*"){o=true}else{o=r.nodeName.toLowerCase()===a}if(o){s.call(this,n)}};if(f){r.push({handle:c,elem:n,fn:s,evt:i})}o(n,i,c,u)}function a(t,n,i,s){if(typeof t!=="object"){throw"addEvent: Expected argument elem of type object, "+typeof t+" given."}var o=null;if(s){for(var u=0,a=r.length;u<a;++u){o=r[u];if(o.elem===t&&o.evt===n&&o.fn===i){i=o.handle;r.splice(u,1);break}}}if(e.addEventListener){t.removeEventListener(n,i,false)}else{t.dettachEvent("on"+n,i)}}function f(e){if(e.stopPropagation){e.stopPropagation()}if(e.preventDefault){e.preventDefault()}e.cancelBubble=true;e.returnValue=false;return false}function l(e,n){var r=t.createElement(e);n=n||{};for(var i in n){if(n.hasOwnProperty(i)){r.setAttribute(i,n[i])}}return r}function c(e,t){if(typeof e!=="object"){throw"addClass: Expected argument elem of type object, "+typeof e+" given."}if(typeof t==="string"){t=[t]}for(var n=0,r=t.length;n<r;++n){if(p("classList")){e.classList.add(t[n])}else{if(!(new RegExp("(?:^|\\s)"+t[n]+"(?:\\s|$)")).test(e.className)){e.className+=" "+t[n]}}}}function h(e,t){if(typeof e!=="object"){throw"removeClass: Expected argument elem of type object, "+typeof e+" given."}if(typeof t==="string"){t=[t]}for(var n=0,r=t.length;n<r;++n){if(p("classList")){e.classList.remove(t[n])}else{var i=e.className.replace(new RegExp("(?:^|\\s)"+t[n]+"(?:\\s|$)","g")," ");e.className=i.replace(/^\s+|\s+$/g,"")}}}function p(n){switch(n){case"localStorage":try{return"localStorage"in e&&!!e.localStorage}catch(r){return false}break;case"classList":return"classList"in t.createElement("a");default:throw"supported: Unknown or unsupported key."}}function v(){i();e.ADI=d}var r=[];var d=function(){function C(){if(!y){return null}var e=t,n=JSON.parse(y.getAttribute("data-js-path"));if(n[0]!==""){for(var r=0,i=n.length;r<i;++r){e=e.childNodes[n[r]]}}return e}function k(){var e={};if(p("localStorage")){e=JSON.parse(localStorage.getItem("ADI.options"))||{}}for(var t in e){N[t]=e[t]}}function L(){if(p("localStorage")&&N.saving){localStorage.setItem("ADI.options",JSON.stringify(N))}}function A(){if(p("localStorage")){localStorage.removeItem("ADI.options")}}function O(e){if(typeof e!=="object"){throw"getElemPaths: Expected argument elem of type object, "+typeof e+" given."}var n="",r="",i="",s,o;while(e!==t){i=e.parentNode;for(s=0,o=i.childNodes.length;s<o;++s){if(i.childNodes[s]===e){r=s+","+r;break}}var u=e.nodeName;if(e.id){u+="#"+e.id}if(e.className){var a=e.classList||e.className.split(" ");for(s=0,o=a.length;s<o;++s){u+="."+a[s]}}n=u+" "+n;e=e.parentNode}r=r.slice(0,-1).split(",");return{cssPath:n.toLowerCase(),jsPath:r}}function M(e){if(typeof e!=="object"){throw"hasRequiredNodes: Expected argument node of type object, "+typeof e+" given."}if(e.hasChildNodes()){for(var t=0,n=e.childNodes.length;t<n;t++){if(N.nodeTypes.indexOf(e.childNodes[t].nodeType)!==-1){return true}}}return false}function _(e){if(typeof e!=="object"){throw"isEmptyTextNode: Expected argument node of type object, "+typeof e+" given."}return/^\s*$/.test(e.textContent)}function D(e,t){if(typeof e!=="object"){throw"containsOnlyText: Expected argument node of type object, "+typeof e+" given."}t=t||false;var r=false,i=null;if(t){for(var s=0,o=e.childNodes.length;s<o;++s){i=e.childNodes[s];r=i.nodeType===n.TEXT_NODE||i.nodeType===n.COMMENT_NODE||i.nodeType===n.CDATA_SECTION_NODE;if(!r){break}}}else{r=e.nodeType===n.TEXT_NODE||e.nodeType===n.COMMENT_NODE||e.nodeType===n.CDATA_SECTION_NODE}return r}function P(e){if(typeof e!=="object"){throw"newTreeNode: Expected argument node of type object, "+typeof e+" given."}var t=M(e),i=false,s=l("li",{"class":t?"adi-node":""});if(e===r){return null}if(t){s.appendChild(l("span",{"class":"adi-trigger"}))}if(N.omitEmptyText&&e.nodeType===n.TEXT_NODE){i=_(e)}if(!i){var o=O(e),u=l("span",{"data-css-path":o.cssPath,"data-js-path":JSON.stringify(o.jsPath)}),a=null;if(D(e)){if(e.nodeType===n.COMMENT_NODE){c(u,"adi-comment-node");if(typeof u.innerText==="string"){u.innerText="<!-- "+e.textContent+" -->"}else{u.textContent="<!-- "+e.textContent+" -->"}}else{c(u,"adi-text-node");u.textContent=e.textContent}}else{c(u,"adi-normal-node");if(e.nodeType!==n.DOCUMENT_NODE){u.textContent="<"+e.nodeName.toLowerCase()+">";if(t){a=l("span");c(a,"adi-end-node");a.textContent="</"+e.nodeName.toLowerCase()+">"}}else{u.textContent=e.nodeName.toLowerCase()}}s.appendChild(u);if(a){s.appendChild(a)}return s}else{return null}}function H(e,t,r){if(typeof e!=="object"){throw"drawDOM: Expected argument root of type object, "+typeof e+" given."}var i=null,s=true;if(r&&N.nodeTypes.indexOf(e.nodeType)!==-1){t.innerHTML="";i=P(e);if(M(e)){i.appendChild(l("ul",{"data-open":true}));c(i.querySelector(".adi-trigger"),"opened")}t.appendChild(i);t=t.querySelector("ul")}for(var o=0,u=e.childNodes.length;o<u;++o){var a=e.childNodes[o],f=M(a);if(N.nodeTypes.indexOf(a.nodeType)!==-1){i=P(a);if(i){if(f){if(N.foldText){s=D(a,true)?false:true}else{s=true}if(a.nodeType===n.DOCUMENT_NODE){i.appendChild(l("ul",{"data-open":s}))}else{i.insertBefore(l("ul",{"data-open":s}),i.lastChild)}c(i.querySelector(".adi-trigger"),s?"opened":"closed")}t.appendChild(i);if(f){H(a,i.querySelector("ul"),false)}}}}}function B(){if(g.className.indexOf("adi-hidden")!==-1){h(g,"adi-hidden")}else{c(g,"adi-hidden");m.textContent="";v.querySelector(".adi-content").innerHTML="";q();H(t,d.querySelector(".adi-tree-view"),true);if(N.saving){L()}else{A()}}}function j(e,t){var n=l("span",{"class":"adi-opt"});n.innerHTML='<label><input type="checkbox" data-opt="'+e+'">'+t+"</label>";return n}function F(){var e=l("div",{id:"adi-opts-view","class":"adi-hidden"}),t=l("span",{"class":"adi-opt-heading"}),n=l("span",{"class":"adi-opt-heading"}),r=l("span",{"class":"adi-opt-close"});t.textContent="General options";n.textContent="Observed nodes";e.appendChild(t);e.appendChild(j("saving","Enable saving of settings"));e.appendChild(j("makeVisible","Scroll to the active element in DOM View"));e.appendChild(j("omitEmptyText","Hide empty text nodes"));e.appendChild(j("foldText","Fold the text nodes"));e.appendChild(j("transparent","Enable transparent background"));e.appendChild(n);e.appendChild(j("nodeTypes-3","Text node"));e.appendChild(j("nodeTypes-8","Comment node"));e.appendChild(r);return e}function I(){var e=l("div",{id:"adi-wrapper","class":N.transparent?"transparent":""}),n=l("div",{id:"adi-dom-view"}),s=l("div",{"class":"adi-content"}),o=l("div",{id:"adi-attr-view"}),u=l("div",{"class":"adi-content"}),a=l("div",{id:"adi-horiz-split"}),f=l("div",{id:"adi-vert-split"}),c=l("ul",{"class":"adi-tree-view"}),h=l("div",{"class":"adi-path-wrap"}),p=l("div",{"class":"adi-path"}),y=l("span",{"class":"adi-path-left"}),b=l("span",{"class":"adi-path-right"}),w=l("div",{id:"adi-panel"}),E=l("div",{"class":"adi-menu-wrap"}),S=l("a",{"class":"adi-menu-config",title:"Settings"}),x=l("a",{"class":"adi-menu-lookup",title:"Lookup tool"}),T=F();s.appendChild(c);n.appendChild(s);o.appendChild(u);h.appendChild(p);h.appendChild(y);h.appendChild(b);E.appendChild(x);E.appendChild(S);w.appendChild(h);w.appendChild(E);e.appendChild(T);e.appendChild(n);e.appendChild(a);e.appendChild(o);e.appendChild(w);e.appendChild(f);t.getElementsByTagName("body")[0].appendChild(e);r=e;i=w;d=r.querySelector("#adi-dom-view");v=r.querySelector("#adi-attr-view");m=p;g=T;q(true)}function q(e){if(r===null){return false}if(e){k()}if(e){g.querySelector('[data-opt="transparent"]').checked=N.transparent;g.querySelector('[data-opt="saving"]').checked=N.saving;g.querySelector('[data-opt="omitEmptyText"]').checked=N.omitEmptyText;g.querySelector('[data-opt="makeVisible"]').checked=N.makeVisible;g.querySelector('[data-opt="foldText"]').checked=N.foldText;g.querySelector('[data-opt="nodeTypes-3"]').checked=N.nodeTypes.indexOf(3)!==-1;g.querySelector('[data-opt="nodeTypes-8"]').checked=N.nodeTypes.indexOf(8)!==-1}r.className=N.transparent?"transparent":"";r.style.display=N.visible?"block":"none";r.style.width=N.width+"px";i.style.width=N.width+"px";d.style.height=N.split+"%";v.style.height=100-N.split+"%";d.querySelector(".adi-content").style.height=d.clientHeight+"px";v.querySelector(".adi-content").style.height=v.clientHeight-i.clientHeight+"px";c(r,N.align)}function R(){if(r===null){return false}r.style.display=N.visible?"none":"block";N.visible=!N.visible;L()}function U(e,t){var n=l("span",{"class":"adi-attr"});n.innerHTML="<label>"+e+': <input type="text" data-attr="'+e+'" value="'+t+'"></label>';return n}function z(e){if(typeof e!=="object"){throw"drawAttrs: Expected argument elem of type object, "+typeof e+" given."}var t=v.querySelector(".adi-content"),n={id:"","class":"",style:""},r={},i=[],s,o,u;t.innerHTML="";for(o=0,u=e.attributes.length;o<u;++o){s=e.attributes[o];switch(s.nodeName.toLowerCase()){case"id":n["id"]=s.nodeValue;break;case"class":n["class"]=s.nodeValue;break;case"style":n["style"]=x;break;default:r[s.nodeName.toLowerCase()]=s.nodeValue}}for(var a in r){i.push(a)}i.sort();t.appendChild(U("id",n["id"]));t.appendChild(U("class",n["class"]));t.appendChild(U("style",n["style"]));t.appendChild(l("hr"));for(o=0,u=i.length;o<u;++o){t.appendChild(U(i[o],r[i[o]]))}}function W(t){var n=t?t.target:e.event.srcElement,r=n.getAttribute("data-attr"),i=n.value,s=C();if(i===""){s.removeAttribute(r)}else{s.setAttribute(r,i)}}function X(t){var n=t?t.target:e.event.srcElement,r=n.getAttribute("data-opt"),i=n.checked;if(r.indexOf("nodeTypes")!==-1){var s=parseInt(r.match(/\d+/)[0]);if(i){N.nodeTypes.push(s)}else{N.nodeTypes.splice(N.nodeTypes.indexOf(s),1)}}else{N[r]=i}}function V(t){t=t||e.event;var n=t.keyCode||t.which;switch(n){case 272:R();break}}function $(n){if(!b){return}n=n||e.event;t.documentElement.style.cursor="e-resize";var r=N.width+T-n.clientX;if(r>=N.minWidth){N.width=r;T=n.clientX;q();L()}G()}function J(n){if(!w){return}n=n||e.event;t.documentElement.style.cursor="n-resize";var i=Math.floor(n.clientY/r.clientHeight*100);if(i>=N.minSplit&&i<=100-N.minSplit){N.split=i;q();L()}}function K(t){var n=t?t.target:e.event.srcElement,r=n.parentNode.querySelector("ul");if(r.getAttribute("data-open")==="true"){h(n,"opened");c(n,"closed");r.setAttribute("data-open","false")}else{h(n,"closed");c(n,"opened");r.setAttribute("data-open","true")}}function Q(t){var n=t?t.target:e.event.srcElement,r=d.querySelector(".adi-active-node");if(r){h(r,"adi-active-node")}if(n.className==="adi-end-node"){n=n.parentNode.querySelector(".adi-normal-node")}y=n;c(n,"adi-active-node");m.textContent=n.getAttribute("data-css-path");if(N.makeVisible){var i=d.querySelector(".adi-content");if(n.offsetTop>=i.clientHeight||n.offsetTop<=i.scrollTop){i.scrollTop=n.offsetTop-Math.floor(i.clientHeight/2)}}G();z(C())}function G(){if(m.scrollWidth>m.clientWidth){c(m.parentNode,"adi-overflowing")}else{h(m.parentNode,"adi-overflowing")}}function Y(t){var n=t?t.target:e.event.srcElement,r=m.scrollWidth-m.clientWidth,i=m.scrollLeft,s=5;if(n.className==="adi-path-right"){m.scrollLeft=i<=r-s?i+s:r}else{m.scrollLeft=i-s>=0?i-s:0}if(!E){E=setInterval(Y,20,t)}}function Z(n){var r=n?n.target:e.event.srcElement,i=t,s;if(r.className==="adi-end-node"){r=r.parentNode.querySelector(".adi-normal-node")}s=JSON.parse(r.getAttribute("data-js-path"));for(var o=0,u=s.length;o<u;++o){i=i.childNodes[s[o]]}if(i){if(n.type==="mouseover"){x=i.getAttribute("style")||"";i.setAttribute("style","outline: 1px dashed red; "+x)}else{if(x===""){i.removeAttribute("style")}else{i.setAttribute("style",x)}}}}function et(n){var r=n?n.target:e.event.srcElement;if(r.className.indexOf("adi-menu-lookup")!==-1){if(S){h(r,"adi-active");S=false;a(t.body,"mouseover",et,true);a(t.body,"mouseout",et,true);a(t.body,"click",et,true)}else{c(r,"adi-active");S=true;u(t.body,"mouseover",et,false,"*",true,"adi-wrapper");u(t.body,"mouseout",et,false,"*",true,"adi-wrapper");u(t.body,"click",et,false,"*",true,"adi-wrapper")}}else{if(n.type==="mouseover"){x=r.getAttribute("style")||"";r.setAttribute("style","outline: 1px dashed red; "+x)}else if(n.type==="mouseout"){r.setAttribute("style",x)}else{S=false;h(i.querySelector(".adi-menu-lookup"),"adi-active");r.setAttribute("style",x);a(t.body,"mouseover",et,true);a(t.body,"mouseout",et,true);a(t.body,"click",et,true);f(n);var s=O(r),o=d.querySelector("[data-js-path='"+JSON.stringify(s.jsPath)+"']");if(o){o.click()}var l=o.parentNode,p;if(l.querySelector("ul")){l.querySelector("ul").setAttribute("data-open","true")}while(l!==d.querySelector(".adi-content")){if(l.className.indexOf("adi-node")!==-1){p=l.querySelector(".adi-trigger");h(p,"closed");c(p,"opened");l=l.parentNode;l.setAttribute("data-open","true")}l=l.parentNode}if(N.makeVisible){var v=d.querySelector(".adi-content");if(o.offsetTop>=v.clientHeight||o.offsetTop<=v.scrollTop){v.scrollTop=o.offsetTop-Math.floor(v.clientHeight/2)}}}}}function tt(){var n=t.getElementById("adi-vert-split"),r=t.getElementById("adi-horiz-split");o(n,"mousedown",function(t){t=t||e.event;f(t);b=true;T=t.clientX},false);o(r,"mousedown",function(t){t=t||e.event;f(t);w=true},false);o(t,"mouseup",function(){t.documentElement.style.cursor="default";b=false;w=false},false);o(t,"mousemove",$,false);o(t,"mousemove",J,false);o(e,"resize",q,false);o(t,"keypress",V,false);u(d,"click",K,false,".adi-trigger");u(d,"click",Q,false,".adi-normal-node");u(d,"click",Q,false,".adi-end-node");u(m.parentNode,"mousedown",Y,false,".adi-path-left");u(m.parentNode,"mousedown",Y,false,".adi-path-right");u(m.parentNode,"mouseup",function(){clearInterval(E);E=false},false,".adi-path-left");u(m.parentNode,"mouseup",function(){clearInterval(E);E=false},false,".adi-path-right");u(d,"mouseover",function(t){var n=t?t.target:e.event.srcElement;c(n.parentNode.querySelector(".adi-normal-node"),"hover")},false,".adi-end-node");u(d,"mouseout",function(t){var n=t?t.target:e.event.srcElement;h(n.parentNode.querySelector(".adi-normal-node"),"hover")},false,".adi-end-node");u(d,"mouseover",Z,false,".adi-end-node");u(d,"mouseover",Z,false,".adi-normal-node");u(d,"mouseout",Z,false,".adi-end-node");u(d,"mouseout",Z,false,".adi-normal-node");o(i.querySelector(".adi-menu-lookup"),"click",et,false);u(g,"change",X,false,"input");u(g,"click",B,false,".adi-opt-close");o(i.querySelector(".adi-menu-config"),"click",B,false);u(v,"change",W,false,"input")}var n=e.Node||s(),r=null,i=null,d=null,v=null,m=null,g=null,y=null,b=false,w=false,E=null,S=false,x="",T=0,N={align:"right",width:340,minWidth:260,split:50,minSplit:30,visible:true,saving:false,transparent:true,omitEmptyText:true,makeVisible:true,foldText:true,nodeTypes:[1,3,8,9]};I();tt();H(t,d.querySelector(".adi-tree-view"),true);return{getSelectedElement:C,toggle:R}}();o(e,"load",v,false)})(this,document)
